name: Convert Markdown to Word

on:
  push:
    branches: [ main ]
    paths:
      - '**.md'
  workflow_dispatch:

permissions:
  contents: write

jobs:
  convert:
    runs-on: ubuntu-latest
    steps:
      - name: Checkout code
        uses: actions/checkout@v4
        with:
          # Fetch all history so git can rebase properly if needed
          fetch-depth: 0

      - name: Install Pandoc
        run: |
          sudo apt-get update
          sudo apt-get install -y pandoc

      - name: Convert Template to Word
        run: |
          pandoc template-without-comments.md \
            --reference-doc="Epic template.docx" \
            -o "Epic Template Auto Gen.docx"

      - name: Commit and Push Word File
        uses: stefanzweifel/git-auto-commit-action@v5
        with:
          commit_message: "Auto-generated Word document"
          file_pattern: '"Epic Template Auto Gen.docx"'
          # This ensures that if the remote changed, 
          # it will pull those changes first.
          push_options: '--force' 
          skip_dirty_check: false
